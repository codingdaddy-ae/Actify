<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Profile | Actify</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/org.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Organization Profile Styles */
        .profile-hero {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            border-radius: 1.5rem;
            padding: 2.5rem;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .profile-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .profile-hero-content {
            position: relative;
            z-index: 1;
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .org-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 700;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .org-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-info {
            flex: 1;
            min-width: 250px;
        }

        .profile-info h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .profile-info .org-type {
            font-size: 0.9rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .profile-info .org-email {
            font-size: 0.9rem;
            opacity: 0.85;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .profile-info .join-date {
            font-size: 0.85rem;
            opacity: 0.75;
            margin-top: 0.75rem;
        }

        .profile-stats-row {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat .value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .profile-stat .label {
            font-size: 0.8rem;
            opacity: 0.85;
        }

        /* Edit Profile Button */
        .edit-profile-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 0.6rem 1.25rem;
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
        }

        .edit-profile-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Profile Sections */
        .profile-section {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .section-header h2 {
            font-size: 1.125rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* About Section */
        .about-text {
            color: var(--text-muted);
            line-height: 1.7;
        }

        .about-text.empty {
            font-style: italic;
        }

        /* Contact Info */
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--slate-50);
            border-radius: 0.75rem;
        }

        .contact-item .icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            background: var(--primary-light);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .contact-item .details {
            flex: 1;
        }

        .contact-item .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .contact-item .value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Recent Events */
        .recent-events-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .recent-event-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--slate-50);
            border-radius: 0.75rem;
            transition: all 0.2s ease;
        }

        .recent-event-item:hover {
            background: #e2e8f0;
        }

        .recent-event-item .event-image {
            width: 60px;
            height: 60px;
            border-radius: 0.5rem;
            object-fit: cover;
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .recent-event-item .event-info {
            flex: 1;
        }

        .recent-event-item .event-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .recent-event-item .event-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            gap: 1rem;
        }

        .recent-event-item .event-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .recent-event-item .event-status.approved {
            background: #d1fae5;
            color: #065f46;
        }

        .recent-event-item .event-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .recent-event-item .event-status.completed {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Impact Stats */
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .impact-card {
            background: var(--slate-50);
            border-radius: 0.75rem;
            padding: 1.25rem;
            text-align: center;
        }

        .impact-card .impact-icon {
            width: 3rem;
            height: 3rem;
            margin: 0 auto 0.75rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .impact-card .impact-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .impact-card .impact-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Edit Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.125rem;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: var(--text-muted);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.95rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .empty-state i {
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <!-- Organization Navigation -->
    <nav class="nav-org">
        <div class="nav-container">
            <a href="org-dashboard.html" class="nav-brand">
                <div class="brand-icon-org">
                    <i data-lucide="heart" class="icon-filled"></i>
                </div>
                <span class="brand-name">Actify Org</span>
            </a>

            <div class="nav-org-links">
                <a href="org-dashboard.html" class="nav-link">
                    <i data-lucide="layout-dashboard"></i>
                    Dashboard
                </a>
                <a href="org-events.html" class="nav-link">
                    <i data-lucide="calendar"></i>
                    My Events
                </a>
                <a href="org-create-event.html" class="nav-link">
                    <i data-lucide="plus-circle"></i>
                    Create Event
                </a>
            </div>

            <div class="nav-org-user">
                <a href="org-profile.html" style="text-decoration: none;">
                    <div class="org-avatar" id="orgAvatar" style="cursor: pointer; border: 2px solid white;" title="View Profile">O</div>
                </a>
                <button onclick="logoutOrganization()" class="logout-btn" title="Logout">
                    <i data-lucide="log-out"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="org-main">
        <!-- Profile Hero -->
        <div class="profile-hero">
            <button class="edit-profile-btn" onclick="openEditModal()">
                <i data-lucide="edit-2" style="width: 1rem; height: 1rem;"></i>
                Edit Profile
            </button>
            <div class="profile-hero-content">
                <div class="org-avatar-large" id="profileAvatar">
                    <span id="avatarLetter">O</span>
                </div>
                <div class="profile-info">
                    <h1 id="orgName">Loading...</h1>
                    <div class="org-type">
                        <i data-lucide="building-2" style="width: 1rem; height: 1rem;"></i>
                        <span id="orgType">Organization</span>
                    </div>
                    <div class="org-email">
                        <i data-lucide="mail" style="width: 1rem; height: 1rem;"></i>
                        <span id="orgEmail">Loading...</span>
                    </div>
                    <div class="join-date" id="joinDate">Member since...</div>
                    
                    <div class="profile-stats-row">
                        <div class="profile-stat">
                            <div class="value" id="statEvents">0</div>
                            <div class="label">Events</div>
                        </div>
                        <div class="profile-stat">
                            <div class="value" id="statVolunteers">0</div>
                            <div class="label">Volunteers</div>
                        </div>
                        <div class="profile-stat">
                            <div class="value" id="statPoints">0</div>
                            <div class="label">VP Distributed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div class="profile-section">
            <div class="section-header">
                <h2>
                    <i data-lucide="info" style="width: 1.25rem; height: 1.25rem; color: var(--primary);"></i>
                    About Us
                </h2>
            </div>
            <p class="about-text" id="aboutText">No description provided. Click "Edit Profile" to add information about your organization.</p>
        </div>

        <!-- Contact Information -->
        <div class="profile-section">
            <div class="section-header">
                <h2>
                    <i data-lucide="contact" style="width: 1.25rem; height: 1.25rem; color: var(--primary);"></i>
                    Contact Information
                </h2>
            </div>
            <div class="contact-grid">
                <div class="contact-item">
                    <div class="icon">
                        <i data-lucide="mail" style="width: 1.25rem; height: 1.25rem;"></i>
                    </div>
                    <div class="details">
                        <div class="label">Email</div>
                        <div class="value" id="contactEmail">-</div>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="icon">
                        <i data-lucide="phone" style="width: 1.25rem; height: 1.25rem;"></i>
                    </div>
                    <div class="details">
                        <div class="label">Phone</div>
                        <div class="value" id="contactPhone">Not provided</div>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="icon">
                        <i data-lucide="globe" style="width: 1.25rem; height: 1.25rem;"></i>
                    </div>
                    <div class="details">
                        <div class="label">Website</div>
                        <div class="value" id="contactWebsite">Not provided</div>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="icon">
                        <i data-lucide="map-pin" style="width: 1.25rem; height: 1.25rem;"></i>
                    </div>
                    <div class="details">
                        <div class="label">Location</div>
                        <div class="value" id="contactLocation">Not provided</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Impact Stats -->
        <div class="profile-section">
            <div class="section-header">
                <h2>
                    <i data-lucide="bar-chart-3" style="width: 1.25rem; height: 1.25rem; color: var(--primary);"></i>
                    Your Impact
                </h2>
            </div>
            <div class="impact-grid">
                <div class="impact-card">
                    <div class="impact-icon" style="background: #d1fae5; color: #10b981;">
                        <i data-lucide="calendar-check" style="width: 1.5rem; height: 1.5rem;"></i>
                    </div>
                    <div class="impact-value" id="impactEvents">0</div>
                    <div class="impact-label">Events Organized</div>
                </div>
                <div class="impact-card">
                    <div class="impact-icon" style="background: #dbeafe; color: #3b82f6;">
                        <i data-lucide="users" style="width: 1.5rem; height: 1.5rem;"></i>
                    </div>
                    <div class="impact-value" id="impactVolunteers">0</div>
                    <div class="impact-label">Volunteers Reached</div>
                </div>
                <div class="impact-card">
                    <div class="impact-icon" style="background: #fef3c7; color: #f59e0b;">
                        <i data-lucide="award" style="width: 1.5rem; height: 1.5rem;"></i>
                    </div>
                    <div class="impact-value" id="impactPoints">0</div>
                    <div class="impact-label">Points Distributed</div>
                </div>
                <div class="impact-card">
                    <div class="impact-icon" style="background: #fce7f3; color: #ec4899;">
                        <i data-lucide="clock" style="width: 1.5rem; height: 1.5rem;"></i>
                    </div>
                    <div class="impact-value" id="impactHours">0</div>
                    <div class="impact-label">Hours Contributed</div>
                </div>
            </div>
        </div>

        <!-- Recent Events -->
        <div class="profile-section">
            <div class="section-header">
                <h2>
                    <i data-lucide="calendar" style="width: 1.25rem; height: 1.25rem; color: var(--primary);"></i>
                    Recent Events
                </h2>
                <a href="org-events.html" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">View All â†’</a>
            </div>
            <div class="recent-events-list" id="recentEventsList">
                <div class="empty-state">
                    <i data-lucide="loader" style="width: 2rem; height: 2rem;" class="spin"></i>
                    <p>Loading events...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="editModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Organization Profile</h3>
                <button class="modal-close" onclick="closeEditModal()">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <div class="form-group">
                        <label for="editName">Organization Name</label>
                        <input type="text" id="editName" placeholder="Enter organization name">
                    </div>
                    <div class="form-group">
                        <label for="editType">Organization Type</label>
                        <input type="text" id="editType" placeholder="e.g., Non-profit, NGO, Community Group">
                    </div>
                    <div class="form-group">
                        <label for="editAbout">About / Description</label>
                        <textarea id="editAbout" placeholder="Tell volunteers about your organization and mission..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editPhone">Phone Number</label>
                        <input type="tel" id="editPhone" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="editWebsite">Website</label>
                        <input type="url" id="editWebsite" placeholder="https://your-website.com">
                    </div>
                    <div class="form-group">
                        <label for="editLocation">Location / Address</label>
                        <input type="text" id="editLocation" placeholder="City, State or full address">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfile()">
                    <i data-lucide="save" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></i>
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        lucide.createIcons();

        let orgData = null;

        // Check organization authentication
        function checkOrgAuth() {
            const org = JSON.parse(localStorage.getItem('organization') || 'null');
            const token = localStorage.getItem('orgToken');
            if (!org || !token) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // Load profile data
        async function loadProfile() {
            if (!checkOrgAuth()) return;

            orgData = JSON.parse(localStorage.getItem('organization'));
            
            // Update nav avatar
            const navAvatar = document.getElementById('orgAvatar');
            if (navAvatar && orgData.name) {
                navAvatar.textContent = orgData.name.charAt(0).toUpperCase();
            }

            // Update profile
            document.getElementById('avatarLetter').textContent = orgData.name ? orgData.name.charAt(0).toUpperCase() : 'O';
            document.getElementById('orgName').textContent = orgData.name || 'Organization';
            document.getElementById('orgType').textContent = orgData.type || 'Organization';
            document.getElementById('orgEmail').textContent = orgData.email || '-';
            document.getElementById('contactEmail').textContent = orgData.email || '-';
            document.getElementById('contactPhone').textContent = orgData.phone || 'Not provided';
            document.getElementById('contactWebsite').textContent = orgData.website || 'Not provided';
            document.getElementById('contactLocation').textContent = orgData.location || 'Not provided';

            // About text
            const aboutEl = document.getElementById('aboutText');
            if (orgData.description || orgData.about) {
                aboutEl.textContent = orgData.description || orgData.about;
                aboutEl.classList.remove('empty');
            } else {
                aboutEl.textContent = 'No description provided. Click "Edit Profile" to add information about your organization.';
                aboutEl.classList.add('empty');
            }

            // Join date
            if (orgData.createdAt) {
                const joinDate = new Date(orgData.createdAt);
                document.getElementById('joinDate').textContent = `Member since ${joinDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}`;
            }

            // Load stats
            await loadStats();
            
            // Load recent events
            await loadRecentEvents();
        }

        // Load stats from API
        async function loadStats() {
            try {
                const response = await fetchOrgWithAuth(`${API_BASE_URL}/org/stats`);
                if (response.ok) {
                    const stats = await response.json();
                    
                    document.getElementById('statEvents').textContent = stats.totalEvents || 0;
                    document.getElementById('statVolunteers').textContent = stats.volunteersReached || 0;
                    document.getElementById('statPoints').textContent = (stats.vpDistributed || 0).toLocaleString();
                    
                    document.getElementById('impactEvents').textContent = stats.totalEvents || 0;
                    document.getElementById('impactVolunteers').textContent = stats.volunteersReached || 0;
                    document.getElementById('impactPoints').textContent = (stats.vpDistributed || 0).toLocaleString();
                    document.getElementById('impactHours').textContent = stats.totalHours || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load recent events
        async function loadRecentEvents() {
            const container = document.getElementById('recentEventsList');
            
            try {
                const response = await fetchOrgWithAuth(`${API_BASE_URL}/org/events`);
                if (response.ok) {
                    const events = await response.json();
                    
                    if (events.length === 0) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <i data-lucide="calendar-plus" style="width: 3rem; height: 3rem;"></i>
                                <p>No events yet. Create your first event!</p>
                                <a href="org-create-event.html">
                                    <button class="btn btn-primary" style="margin-top: 1rem;">Create Event</button>
                                </a>
                            </div>
                        `;
                        lucide.createIcons();
                        return;
                    }

                    // Show only last 5 events
                    const recentEvents = events.slice(0, 5);
                    const defaultImage = 'https://images.unsplash.com/photo-1559027615-cd4628902d4a?w=200&q=80';

                    container.innerHTML = recentEvents.map(event => `
                        <a href="org-events.html" style="text-decoration: none;">
                            <div class="recent-event-item">
                                <img src="${event.imageUrl || defaultImage}" alt="${event.title}" class="event-image">
                                <div class="event-info">
                                    <div class="event-title">${event.title}</div>
                                    <div class="event-meta">
                                        <span><i data-lucide="calendar" style="width: 0.8rem; height: 0.8rem;"></i> ${new Date(event.date).toLocaleDateString()}</span>
                                        <span><i data-lucide="users" style="width: 0.8rem; height: 0.8rem;"></i> ${event.volunteersRegistered || 0} volunteers</span>
                                    </div>
                                </div>
                                <span class="event-status ${event.status}">${event.status}</span>
                            </div>
                        </a>
                    `).join('');
                    lucide.createIcons();
                }
            } catch (error) {
                console.error('Error loading events:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <i data-lucide="alert-circle" style="width: 2rem; height: 2rem; color: #ef4444;"></i>
                        <p>Failed to load events</p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        // Open edit modal
        function openEditModal() {
            const modal = document.getElementById('editModal');
            modal.style.display = 'flex';
            
            // Populate form with current data
            if (orgData) {
                document.getElementById('editName').value = orgData.name || '';
                document.getElementById('editType').value = orgData.type || '';
                document.getElementById('editAbout').value = orgData.description || orgData.about || '';
                document.getElementById('editPhone').value = orgData.phone || '';
                document.getElementById('editWebsite').value = orgData.website || '';
                document.getElementById('editLocation').value = orgData.location || '';
            }
            
            lucide.createIcons();
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Save profile changes
        async function saveProfile() {
            const updatedData = {
                name: document.getElementById('editName').value.trim(),
                type: document.getElementById('editType').value.trim(),
                description: document.getElementById('editAbout').value.trim(),
                phone: document.getElementById('editPhone').value.trim(),
                website: document.getElementById('editWebsite').value.trim(),
                location: document.getElementById('editLocation').value.trim()
            };

            try {
                const response = await fetchOrgWithAuth(`${API_BASE_URL}/org/profile`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // Update local storage
                    const updatedOrg = { ...orgData, ...updatedData };
                    localStorage.setItem('organization', JSON.stringify(updatedOrg));
                    
                    closeEditModal();
                    
                    // Show success message
                    alert('Profile updated successfully!');
                    
                    // Reload profile
                    loadProfile();
                } else {
                    // If API doesn't support this yet, just save locally
                    const updatedOrg = { ...orgData, ...updatedData };
                    localStorage.setItem('organization', JSON.stringify(updatedOrg));
                    
                    closeEditModal();
                    alert('Profile saved locally!');
                    loadProfile();
                }
            } catch (error) {
                console.error('Error saving profile:', error);
                // Save locally as fallback
                const updatedOrg = { ...orgData, ...updatedData };
                localStorage.setItem('organization', JSON.stringify(updatedOrg));
                
                closeEditModal();
                alert('Profile saved locally!');
                loadProfile();
            }
        }

        // Close modal on outside click
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // Initialize
        loadProfile();
    </script>
</body>

</html>
